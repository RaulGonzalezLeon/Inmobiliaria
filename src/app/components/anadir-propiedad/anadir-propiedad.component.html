<div class="container mt-4">
  <h2 class="text-center mb-4">Añadir Nueva Vivienda</h2>
  <form novalidate class="needs-validation" (ngSubmit)="onSubmit($event)">
    
    <div class="mb-3">
      <label for="titulo" class="form-label">Título</label>
      <input
        type="text"
        name="titulo"
        [(ngModel)]="propiedad.titulo"
        id="titulo"
        class="form-control"
        placeholder="Escriba el título"
        required
      />
      <div class="invalid-feedback" *ngIf="!propiedad.titulo">
        <b>El título es obligatorio</b>
      </div>
      <div class="invalid-feedback" *ngIf="propiedad.titulo && (propiedad.titulo.length < 4 || propiedad.titulo.length > 150)">
        <b>El título debe tener entre 4 y 150 caracteres</b>
      </div>
    </div>

    <div class="mb-3">
      <label for="tipo" class="form-label">Tipo de Propiedad</label>
      <select
        name="tipo"
        [(ngModel)]="propiedad.tipo_propiedad"
        id="tipo"
        class="form-select"
        required
      >
        <option value="">Seleccione un tipo</option>
        @for (tipo of tiposPropiedad; track tipo.id) {
          <option [value]="tipo.id">{{ tipo.nombre }}</option>
        }
      </select>
      <div class="invalid-feedback">
        <b>El tipo de propiedad es obligatorio</b>
      </div>
    </div>

    <div class="mb-3">
      <label for="descripcion" class="form-label">Descripción</label>
      <textarea
        name="descripcion"
        [(ngModel)]="propiedad.descripcion"
        id="descripcion"
        class="form-control"
        placeholder="Ingrese una descripción"
        required
      ></textarea>
      <div class="invalid-feedback" *ngIf="!propiedad.descripcion">
        <b>La descripción es obligatoria</b>
      </div>
      <div class="invalid-feedback" *ngIf="propiedad.descripcion && (propiedad.descripcion.length < 10 || propiedad.descripcion.length > 300)">
        <b>La descripción debe tener entre 10 y 300 caracteres</b>
      </div>
    </div>

    <div class="mb-3">
      <label for="direccion" class="form-label">Dirección</label>
      <input
        type="text"
        name="direccion"
        [(ngModel)]="propiedad.direccion"
        id="direccion"
        class="form-control"
        placeholder="Ingrese la dirección"
        required
      />
      <div class="invalid-feedback" *ngIf="!propiedad.direccion">
        <b>La dirección es obligatoria</b>
      </div>
      <div class="invalid-feedback" *ngIf="propiedad.direccion && (propiedad.direccion.length < 4 || propiedad.direccion.length > 150)">
        <b>La dirección debe tener entre 4 y 150 caracteres</b>
      </div>
    </div>

    <div class="mb-3">
      <label for="ciudad" class="form-label">Ciudad</label>
      <input
        type="text"
        name="ciudad"
        [(ngModel)]="propiedad.ciudad"
        id="ciudad"
        class="form-control"
        placeholder="Ingrese la ciudad"
        required
      />
      <div class="invalid-feedback" *ngIf="!propiedad.ciudad">
        <b>La ciudad es obligatoria</b>
      </div>
      <div class="invalid-feedback" *ngIf="propiedad.ciudad && (propiedad.ciudad.length < 2 || propiedad.ciudad.length > 100)">
        <b>La ciudad debe tener entre 2 y 100 caracteres</b>
      </div>
    </div>

    <div class="mb-3">
      <label for="precio" class="form-label">Precio</label>
      <input
        type="number"
        name="precio"
        [(ngModel)]="propiedad.precio"
        id="precio"
        class="form-control"
        placeholder="Escriba el precio"
        min="50000"
        required
      />
      <div class="invalid-feedback" *ngIf="!propiedad.precio">
        <b>El precio es obligatorio</b>
      </div>
      <div class="invalid-feedback" *ngIf="propiedad.precio && propiedad.precio < 50000">
        <b>El precio debe ser de al menos 50.000€</b>
      </div>
    </div>

    <div class="mb-3">
      <label for="habitaciones" class="form-label">Habitaciones</label>
      <input
        type="number"
        name="habitaciones"
        [(ngModel)]="propiedad.habitaciones"
        id="habitaciones"
        class="form-control"
        placeholder="Número de habitaciones"
        min="1"
        required
      />
      <div class="invalid-feedback" *ngIf="!propiedad.habitaciones">
        <b>Debe indicar el número de habitaciones</b>
      </div>
      <div class="invalid-feedback" *ngIf="propiedad.habitaciones && propiedad.habitaciones < 1">
        <b>Debe haber al menos 1 habitación</b>
      </div>
    </div>

    <div class="mb-3">
      <label for="banos" class="form-label">Baños</label>
      <input
        type="number"
        name="banos"
        [(ngModel)]="propiedad.banos"
        id="banos"
        class="form-control"
        placeholder="Número de baños"
        min="1"
        required
      />
      <div class="invalid-feedback" *ngIf="!propiedad.banos">
        <b>Debe indicar el número de baños</b>
      </div>
      <div class="invalid-feedback" *ngIf="propiedad.banos && propiedad.banos < 1">
        <b>Debe haber al menos 1 baño</b>
      </div>
    </div>

    <div class="mb-3">
      <label for="superficie" class="form-label">Superficie (m²)</label>
      <input
        type="number"
        name="superficie"
        [(ngModel)]="propiedad.superficie"
        id="superficie"
        class="form-control"
        placeholder="Superficie en metros cuadrados"
        min="30"
        required
      />
      <div class="invalid-feedback" *ngIf="!propiedad.superficie">
        <b>Debe indicar la superficie</b>
      </div>
      <div class="invalid-feedback" *ngIf="propiedad.superficie && propiedad.superficie < 30">
        <b>La superficie mínima es de 30 m²</b>
      </div>
    </div>

    <div class="mb-3">
      <label for="imagen" class="form-label">Imagen</label>
      <input
        type="file"
        accept="image/*"
        id="imagen"
        class="form-control"
        (change)="onFileSelected($event)"
      />
    </div>

    <button type="submit" class="btn btn-primary w-100">
      Guardar
    </button>
  </form>

@if (mostrarBanner) {
  <div class="alert alert-success custom-banner d-flex align-items-center" role="alert">
    <span class="material-symbols-outlined me-2 banner-icon">check_circle</span>
    <div class="banner-text">¡Propiedad añadida correctamente!</div>
  </div>
}
</div>
